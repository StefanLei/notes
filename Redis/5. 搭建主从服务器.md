#### Redis 搭建主从复用-读写分离

Redis 支持主从复用。数据可以从主服务器向任意数量的 从服务器上同步，同步使用的是发布/订阅机制。Mater Slave 的模式，Slave 向 Master 发起 SYNC 命令。 可以是 1 Master 多 Slave，可以分层，Slave 下可以再接 Slave，可扩展成树状结构.

###### 修改主服务器的配置

```
# 设置从服务器只读模式
slave-read-only yes

# 设置密码  也可以不设置
requirepass 123456

# 设置主服务器的密码，这里是为了使用哨兵模式后，这个变成slave服务器。所以也指定密码
masterauth 123456
```

###### 修改从服务器的配置

```
# 修改监听的端口，防止冲突
port 6381 

# 指定主服务器的密码
masterauth 123456

# 设置密码  也可以不设置
requirepass 123456

# 设置同步的主服务器地址
slaveof 127.0.0.1 6379
```

先启动主服务器，再启动从服务器

使用 `info replication` 命令查询信息

---

### 全量同步	

redis 全量复制，一般发生在 `slave` 初始化阶段，这时 `salve` 需要将 `master` 上的所有数据都复制一份。具体步骤如下

- `slave`连接`master`，发送 SYNC 命令给`master`
- `master`接受到 SYNC 命令后，开始执行 BGSAVE 命令生成 RDB 文件，并使用缓存区记录这个过程的期间执行的所有的命令。
- `master` BGSAVE 命令执行完成后，向所有的`slave`发送快照文件，并